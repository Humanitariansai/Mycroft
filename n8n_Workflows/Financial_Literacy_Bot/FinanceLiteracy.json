{
  "name": "Educational Agent - Financial Literacy",
  "nodes": [
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        }
      },
      "name": "Trigger: User Query",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [250, 300]
    },
    {
      "parameters": {
        "operation": "get",
        "table": "user_interactions",
        "returnAll": true
      },
      "name": "Postgres: Fetch User History",
      "type": "n8n-nodes-base.postgres",
      "position": [450, 300],
      "credentials": {
        "postgres": "PostgresAccount"
      }
    },
    {
      "parameters": {
        "operation": "search",
        "index": "financial_concepts",
        "query": "={{ $json.user_query }}",
        "limit": 5
      },
      "name": "Pinecone: Vector Search Concepts",
      "type": "@pinecone-database/n8n-nodes-pinecone.pinecone",
      "position": [450, 450],
      "credentials": {
        "pineconeApi": "PineconeAccount"
      }
    },
    {
      "parameters": {
        "model": "gpt-4",
        "prompt": "=Analyze this user's financial literacy level based on their history:\n\nUser Query: {{ $json.user_query }}\nPrevious Interactions: {{ $node['Postgres: Fetch User History'].json }}\n\nIdentify:\n1. Knowledge gaps\n2. Current understanding level\n3. Prerequisite concepts needed\n4. Learning style preferences\n\nReturn as JSON with fields: gaps, level, prerequisites, style"
      },
      "name": "LLM: Analyze Knowledge Gaps",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [650, 300]
    },
    {
      "parameters": {
        "query": "={{ $json.gaps[0] }} financial concept explanation beginner",
        "searchDepth": "advanced"
      },
      "name": "Perplexity: Research Concept",
      "type": "n8n-nodes-base.perplexity",
      "position": [850, 200],
      "credentials": {
        "perplexityApi": "PerplexityAccount"
      }
    },
    {
      "parameters": {
        "operation": "insert",
        "table": "concept_embeddings",
        "columns": "concept, embedding, source",
        "values": "={{ $json.concept }}, ={{ $json.embedding }}, perplexity"
      },
      "name": "Postgres: Store New Concepts",
      "type": "n8n-nodes-base.postgres",
      "position": [1050, 200]
    },
    {
      "parameters": {
        "model": "text-embedding-ada-002",
        "text": "={{ $json.research_content }}"
      },
      "name": "OpenAI: Generate Embeddings",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "position": [1050, 300]
    },
    {
      "parameters": {
        "operation": "upsert",
        "index": "financial_concepts",
        "id": "={{ $json.concept_id }}",
        "vector": "={{ $json.embedding }}",
        "metadata": {
          "concept": "={{ $json.concept }}",
          "difficulty": "={{ $json.level }}",
          "prerequisites": "={{ $json.prerequisites }}"
        }
      },
      "name": "Pinecone: Update Vector DB",
      "type": "@pinecone-database/n8n-nodes-pinecone.pinecone",
      "position": [1250, 300]
    },
    {
      "parameters": {
        "model": "gpt-4",
        "systemMessage": "You are an adaptive financial education tutor. Tailor explanations to the user's level and learning style.",
        "prompt": "=Based on:\n- User Level: {{ $node['LLM: Analyze Knowledge Gaps'].json.level }}\n- Knowledge Gaps: {{ $node['LLM: Analyze Knowledge Gaps'].json.gaps }}\n- Research Data: {{ $node['Perplexity: Research Concept'].json }}\n- Similar Concepts: {{ $node['Pinecone: Vector Search Concepts'].json }}\n\nCreate a personalized explanation for: {{ $json.user_query }}\n\nInclude:\n1. Core concept explanation (appropriate to their level)\n2. Real-world examples\n3. Connection to prerequisites\n4. Interactive element or analogy\n5. Next learning steps"
      },
      "name": "LLM: Generate Contextual Explanation",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [850, 400]
    },
    {
      "parameters": {
        "operation": "insert",
        "table": "learning_interactions",
        "columns": "user_id, query, response, gaps_identified, timestamp",
        "values": "={{ $json.user_id }}, ={{ $json.user_query }}, ={{ $node['LLM: Generate Contextual Explanation'].json.response }}, ={{ $node['LLM: Analyze Knowledge Gaps'].json.gaps }}, ={{ $now }}"
      },
      "name": "Postgres: Log Interaction",
      "type": "n8n-nodes-base.postgres",
      "position": [1050, 400]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $node['LLM: Analyze Knowledge Gaps'].json.level }}",
              "operation": "equals",
              "value2": "beginner"
            }
          ]
        }
      },
      "name": "IF: Check User Level",
      "type": "n8n-nodes-base.if",
      "position": [650, 500]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=SELECT concept, COUNT(*) as confusion_count\nFROM learning_interactions\nWHERE user_id = '{{ $json.user_id }}'\nAND gaps_identified IS NOT NULL\nGROUP BY concept\nORDER BY confusion_count DESC\nLIMIT 3"
      },
      "name": "Postgres: Identify Recurring Gaps",
      "type": "n8n-nodes-base.postgres",
      "position": [850, 500]
    },
    {
      "parameters": {
        "model": "gpt-4",
        "prompt": "=This user repeatedly struggles with: {{ $json.recurring_concepts }}\n\nGenerate:\n1. A customized learning path\n2. Simplified prerequisite lessons\n3. Practice exercises\n4. Assessment questions\n\nFormat as structured JSON"
      },
      "name": "LLM: Create Learning Path",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [1050, 500]
    },
    {
      "parameters": {
        "operation": "insert",
        "table": "learning_paths",
        "columns": "user_id, path_data, created_at",
        "values": "={{ $json.user_id }}, ={{ $json.learning_path }}, ={{ $now }}"
      },
      "name": "Postgres: Save Learning Path",
      "type": "n8n-nodes-base.postgres",
      "position": [1250, 500]
    },
    {
      "parameters": {
        "query": "={{ $json.concept }} real-world case study financial market",
        "searchDepth": "basic"
      },
      "name": "Perplexity: Find Real Examples",
      "type": "n8n-nodes-base.perplexity",
      "position": [850, 600]
    },
    {
      "parameters": {
        "model": "gpt-4",
        "prompt": "=Create an interactive scenario based on:\n- Concept: {{ $json.concept }}\n- Real Example: {{ $node['Perplexity: Find Real Examples'].json }}\n- User Level: {{ $node['LLM: Analyze Knowledge Gaps'].json.level }}\n\nGenerate a decision-tree scenario where the user makes investment choices and sees outcomes. Include 3-4 decision points."
      },
      "name": "LLM: Generate Interactive Scenario",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [1050, 600]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=SELECT \n  AVG(CASE WHEN assessment_score > 70 THEN 1 ELSE 0 END) as success_rate,\n  methodology,\n  COUNT(*) as sample_size\nFROM learning_interactions\nWHERE created_at > NOW() - INTERVAL '30 days'\nGROUP BY methodology\nORDER BY success_rate DESC"
      },
      "name": "Postgres: Analyze Method Effectiveness",
      "type": "n8n-nodes-base.postgres",
      "position": [650, 700]
    },
    {
      "parameters": {
        "model": "gpt-4",
        "prompt": "=Analyze which educational approaches work best:\n{{ $json.effectiveness_data }}\n\nRecommend:\n1. Which methodology to use for this user\n2. Adjustments to current approach\n3. A/B test suggestions for improvement"
      },
      "name": "LLM: Optimize Teaching Method",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [850, 700]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $node['LLM: Generate Contextual Explanation'].json.response }}\n\nInteractive Scenario:\n{{ $node['LLM: Generate Interactive Scenario'].json.scenario }}\n\nRecommended Next Steps:\n{{ $node['LLM: Create Learning Path'].json.next_steps }}"
      },
      "name": "Response: Send to User",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [1250, 400]
    }
  ],
  "connections": {
    "Trigger: User Query": {
      "main": [
        [
          {
            "node": "Postgres: Fetch User History",
            "type": "main",
            "index": 0
          },
          {
            "node": "Pinecone: Vector Search Concepts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres: Fetch User History": {
      "main": [
        [
          {
            "node": "LLM: Analyze Knowledge Gaps",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LLM: Analyze Knowledge Gaps": {
      "main": [
        [
          {
            "node": "Perplexity: Research Concept",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF: Check User Level",
            "type": "main",
            "index": 0
          },
          {
            "node": "LLM: Generate Contextual Explanation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Perplexity: Research Concept": {
      "main": [
        [
          {
            "node": "OpenAI: Generate Embeddings",
            "type": "main",
            "index": 0
          },
          {
            "node": "Postgres: Store New Concepts",
            "type": "main",
            "index": 0
          },
          {
            "node": "Perplexity: Find Real Examples",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI: Generate Embeddings": {
      "main": [
        [
          {
            "node": "Pinecone: Update Vector DB",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LLM: Generate Contextual Explanation": {
      "main": [
        [
          {
            "node": "Postgres: Log Interaction",
            "type": "main",
            "index": 0
          },
          {
            "node": "Response: Send to User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF: Check User Level": {
      "main": [
        [
          {
            "node": "Postgres: Identify Recurring Gaps",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres: Identify Recurring Gaps": {
      "main": [
        [
          {
            "node": "LLM: Create Learning Path",
            "type": "main",
            "index": 0
          },
          {
            "node": "Postgres: Analyze Method Effectiveness",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LLM: Create Learning Path": {
      "main": [
        [
          {
            "node": "Postgres: Save Learning Path",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Perplexity: Find Real Examples": {
      "main": [
        [
          {
            "node": "LLM: Generate Interactive Scenario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres: Analyze Method Effectiveness": {
      "main": [
        [
          {
            "node": "LLM: Optimize Teaching Method",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pinecone: Vector Search Concepts": {
      "main": [
        [
          {
            "node": "LLM: Generate Contextual Explanation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}